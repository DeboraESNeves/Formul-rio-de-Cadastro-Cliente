@model Formulario_Cadastro_Cliente.Models.AddClienteViewModel

<h1>Adicionar Cliente</h1>

@if (!ViewData.ModelState.IsValid)
{
    <div class="alert alert-danger">
        <ul>
            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
            {
                <li>@error.ErrorMessage</li>
            }
        </ul>
    </div>
}

<form method="post">
    <div class="mt-3">
        <label class="form-label">Nome</label>
        <input type="text" class="form-control" asp-for="Nome" id="Nome" />
    </div>

    <div class="mt-3">
        <label class="form-label">CPF</label>
        <input type="text"
               class="form-control cpf"
               placeholder="000.000.000-00"
               maxlength="14"
               pattern="\d{3}\.\d{3}\.\d{3}-\d{2}"
               title="Informe um CPF no formato 000.000.000-00"
               required
               asp-for="Cpf"
               id="Cpf" />
        <span asp-validation-for="Cpf" class="text-danger"></span>
    </div>

    <div class="mt-3">
        <label class="form-label">Email</label>
        <input type="email" class="form-control"
               placeholder="Cliente@email.com"
               asp-for="Email"
               id="Email" />
    </div>

    <div class="mt-3">
        <label class="form-label">Telefone</label>
        <input type="text" class="form-control telefone"
               placeholder="(11)91234-5678"
               maxlength="15"
               pattern="\(\d{2}\)\d{4,5}-\d{4}"
               title="Informe um número de telefone válido no formato (11)91234-5678"
               required
               asp-for="Telefone"
               id="Telefone" />
    </div>

    <div class="mt-3">
        <label class="form-label">CEP</label>
        <input type="text"
               class="form-control"
               maxlength="8"
               pattern="\d{8}"
               asp-for="CEP"
               id="CEP" />
    </div>

    <div class="mt-3">
        <label class="form-label">Rua</label>
        <input type="text" class="form-control" asp-for="Rua" id="Rua" />
    </div>

    <div class="mt-3">
        <label class="form-label">Bairro</label>
        <input type="text" class="form-control" asp-for="Bairro" id="Bairro" />
    </div>

    <div class="mt-3">
        <label class="form-label">Cidade</label>
        <input type="text" class="form-control" asp-for="Cidade" id="Cidade" />
    </div>

    <div class="mt-3">
        <label class="form-label">Estado</label>
        <input type="text" class="form-control" asp-for="Estado" id="Estado" />
    </div>

    <div class="form-check mt-3">
        <input type="hidden" asp-for="Ativo" value="false" />
        <input asp-for="Ativo" class="form-check-input" type="checkbox" value="true" />
        <label asp-for="Ativo" class="form-check-label"></label>
    </div>

    <div class="mt-3">
        <button type="submit" class="btn btn-primary">Salvar</button>
    </div>
</form>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.querySelector("form");

            form.addEventListener("submit", function (e) {
                let valido = true;
                let mensagens = [];

                const nome = document.getElementById("Nome").value.trim();
                const cpf = document.getElementById("Cpf").value.trim();
                const email = document.getElementById("Email").value.trim();
                const telefone = document.getElementById("Telefone").value.trim();
                const cep = document.getElementById("CEP").value.trim();
                const rua = document.getElementById("Rua").value.trim();
                const bairro = document.getElementById("Bairro").value.trim();
                const cidade = document.getElementById("Cidade").value.trim();
                const estado = document.getElementById("Estado").value.trim();

                // Campos obrigatórios básicos
                if (nome === "") {
                    valido = false;
                    mensagens.push("O campo Nome é obrigatório.");
                }
                if (cpf === "") {
                    valido = false;
                    mensagens.push("O campo CPF é obrigatório.");
                }
                if (email === "") {
                    valido = false;
                    mensagens.push("O campo Email é obrigatório.");
                }
                if (telefone === "") {
                    valido = false;
                    mensagens.push("O campo Telefone é obrigatório.");
                }

                // Se o CEP estiver vazio-endereço manual
                if (cep === "") {
                    if (rua === "" || bairro === "" || cidade === "" || estado === "") {
                        valido = false;
                        mensagens.push("Preencha o endereço completo (Rua, Bairro, Cidade e Estado) se não informar o CEP.");
                    }
                } else {
                    // CEP informado
                    const cepRegex = /^\d{8}$/;
                    if (!cepRegex.test(cep)) {
                        valido = false;
                        mensagens.push("CEP deve conter exatamente 8 dígitos numéricos.");
                    }
                }

                // Validação de formatos
                const cpfRegex = /^\d{3}\.\d{3}\.\d{3}-\d{2}$/;
                if (cpf && !cpfRegex.test(cpf)) {
                    valido = false;
                    mensagens.push("O CPF deve estar no formato 000.000.000-00.");
                }

                const telRegex = /^\(\d{2}\)\d{4,5}-\d{4}$/;
                if (telefone && !telRegex.test(telefone)) {
                    valido = false;
                    mensagens.push("Telefone deve estar no formato (11)91234-5678.");
                }

                if (!valido) {
                    e.preventDefault();
                    alert(mensagens.join("\n"));
                }
            });

        });
    </script>

    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
